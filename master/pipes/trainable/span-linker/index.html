<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><link href="../span-classifier/" rel="prev"/><link href="../../../tokenizers/" rel="next"/><link href="../../../assets/logo/edsnlp.svg" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.5.42" name="generator"/><title>Span Linker - EDS-NLP</title><link href="../../../assets/stylesheets/main.0253249f.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../../assets/stylesheets/extra.css" rel="stylesheet"/><link href="../../../assets/stylesheets/cards.css" rel="stylesheet"/><link href="../../../assets/termynal/termynal.css" rel="stylesheet"/><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#edsnlp.pipes.trainable.span_linker.factory.create_component"> Skip to content </a> </div> <div data-md-component="announce"> <aside class="md-banner"> <div class="md-banner__inner md-grid md-typeset"> <button aria-label="Don't show this again" class="md-banner__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> Check out the new <a href="../../../tutorials/training">Model Training tutorial</a> ! </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <div data-md-color-scheme="default" data-md-component="outdated" hidden=""> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="EDS-NLP" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="EDS-NLP"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> EDS-NLP </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Span Linker </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/aphp/edsnlp" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg> </div> <div class="md-source__repository"> aphp/edsnlp </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="EDS-NLP" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="EDS-NLP"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> EDS-NLP </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/aphp/edsnlp" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg> </div> <div class="md-source__repository"> aphp/edsnlp </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../.."> <span class="md-ellipsis"> Getting started </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="https://aphp.github.io/edsnlp/demo" target="_blank"> <span class="md-ellipsis"> Demo </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../tutorials/"> <span class="md-ellipsis"> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../"> <span class="md-ellipsis"> Pipes </span> </a> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Pipes </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../core/"> <span class="md-ellipsis"> Core Pipelines </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../qualifiers/"> <span class="md-ellipsis"> Qualifiers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../misc/"> <span class="md-ellipsis"> Miscellaneous </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../ner/"> <span class="md-ellipsis"> Named Entity Recognition </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_4_7" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Trainable components </span> </a> <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="true" aria-labelledby="__nav_4_7_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_4_7"> <span class="md-nav__icon md-icon"></span> Trainable components </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../embeddings/transformer/"> <span class="md-ellipsis"> Transformer </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../embeddings/text_cnn/"> <span class="md-ellipsis"> Text CNN </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../embeddings/span_pooler/"> <span class="md-ellipsis"> Span Pooler </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../ner/"> <span class="md-ellipsis"> NER </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../span-classifier/"> <span class="md-ellipsis"> Span Classifier </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Span Linker </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> Span Linker </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--how-it-works"> <span class="md-ellipsis"> How it works </span> </a> <nav aria-label="How it works" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--synonym-similarity"> <span class="md-ellipsis"> Synonym similarity </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--concept-similarity"> <span class="md-ellipsis"> Concept similarity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--examples"> <span class="md-ellipsis"> Examples </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--parameters"> <span class="md-ellipsis"> Parameters </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--authors-and-citation"> <span class="md-ellipsis"> Authors and citation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../tokenizers/"> <span class="md-ellipsis"> Tokenizers </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../data/"> <span class="md-ellipsis"> Data Connectors </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../concepts/pipeline/"> <span class="md-ellipsis"> Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../utilities/"> <span class="md-ellipsis"> Utilities </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../reference/edsnlp/"> <span class="md-ellipsis"> Code Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../contributing/"> <span class="md-ellipsis"> Contributing to EDS-NLP </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../changelog/"> <span class="md-ellipsis"> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--how-it-works"> <span class="md-ellipsis"> How it works </span> </a> <nav aria-label="How it works" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--synonym-similarity"> <span class="md-ellipsis"> Synonym similarity </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--concept-similarity"> <span class="md-ellipsis"> Concept similarity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--examples"> <span class="md-ellipsis"> Examples </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--parameters"> <span class="md-ellipsis"> Parameters </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.pipes.trainable.span_linker.factory.create_component--authors-and-citation"> <span class="md-ellipsis"> Authors and citation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 class="sourced-heading" id="edsnlp.pipes.trainable.span_linker.factory.create_component">Trainable Span Linker<span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/1ebc7d72c/edsnlp/pipes/trainable/span_linker/span_linker.py#L64" target="_blank">[source]</a></h1> <div class="doc doc-object doc-attribute"> <div class="doc doc-contents first"> <p>The <code><a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a></code> component is a trainable span concept predictor, typically used to match spans in the text with concepts in a knowledge base. This task is known as "Entity Linking", "Named Entity Disambiguation" or "Normalization" (the latter is mostly used in the biomedical machine learning community).</p> <div class="admonition warning"> <p class="admonition-title">Entity Linking vs Named Entity Recognition</p> <p>Entity Linking is the task of linking existing entities to their concept in a knowledge base, while Named Entity Recognition is the task of detecting spans in the text that correspond to entities. The <code><a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a></code> component should therefore be used after the Named Entity Recognition step (e.g. using the <code><a href="../ner/#edsnlp.pipes.trainable.ner_crf.factory.create_component">eds.ner_crf</a></code> component).</p> </div> <h2 id="edsnlp.pipes.trainable.span_linker.factory.create_component--how-it-works">How it works</h2> <p>To perform this task, this components compare the embedding of a given query span (e.g. "aspirin") with the embeddings in the knowledge base, where each embedding represents a concept (e.g. "B01AC06"), and selects the most similar embedding and returns its concept id. This comparison is done using either:</p> <ul> <li>the cosine similarity between the input and output embeddings (recommended)</li> <li>a simple dot product</li> </ul> <p>We filter out the concepts that are not relevant for a given query by using groups. For each span to link, we use its label to select a group of concepts to compare with. For example, if the span is labeled as "drug", we only compare it with concepts that are drugs. These concepts groups are inferred from the training data when running the <code>post_init</code> method, or can be provided manually using the <code>pipe.update_concepts(concepts, mapping, [embeddings])</code> method. If a label is not found in the mapping, the span is compared with all concepts.</p> <p>We support comparing entity queries against two kind of references : either the embeddings of the concepts themselves (<code>reference_mode = "concept"</code>), or the embeddings of the synonyms of the concepts (<code>reference_mode = "synonym"</code>).</p> <h3 id="edsnlp.pipes.trainable.span_linker.factory.create_component--synonym-similarity">Synonym similarity</h3> <p>When performing span linking in <code>synonym</code> mode, the span linker embedding matrix contains one embedding vector per concept per synonym, and each embedding maps to the concept of its synonym. This mode is slower and more memory intensive, since you have to store multiple embeddings per concept, but it can yield good results in zero-shot scenarios (see example below).</p> <figure> <p><img alt="Synonym similarity" src="../../../assets/images/synonym_span_linker.png"/> </p> <figcaption>Entity linking based on synonym similarity</figcaption> </figure> <h3 id="edsnlp.pipes.trainable.span_linker.factory.create_component--concept-similarity">Concept similarity</h3> <p>In <code>concept</code> mode, the span linker embedding matrix contains one embedding vector per concept : imagine a single vector that approximately averages all the synonyms of a concept (e.g. B01AC06 = average of "aspirin", "acetyl-salicylic acid", etc.). This mode is faster and more memory efficient, but usually requires that the concept weights are fine-tuned.</p> <figure> <p><img alt="Concept similarity" src="../../../assets/images/class_span_linker.png"/> </p> <figcaption>Entity linking based on concept similarity</figcaption> </figure> <h2 id="edsnlp.pipes.trainable.span_linker.factory.create_component--examples">Examples</h2> <p>Here is how you can use the <code><a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a></code> component to link spans without training, in <code>synonym</code> mode. You will still need to pre-compute the embeddings of the target synonyms.</p> <p>First, initialize the component:</p> <div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">edsnlp</span><span class="o">,</span> <span class="nn">edsnlp.pipes</span> <span class="k">as</span> <span class="nn">eds</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">edsnlp</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../reference/edsnlp/core/pipeline/#edsnlp.core.pipeline.blank">blank</a></body></html></span><span class="p">(</span><span class="s2">"eds"</span><span class="p">)</span>
<span class="n">nlp</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../reference/edsnlp/core/pipeline/#edsnlp.core.pipeline.Pipeline.add_pipe">add_pipe</a></body></html></span><span class="p">(</span>
    <a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a><span class="p">(</span>
        <span class="n">rescale</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s2">"cosine"</span><span class="p">,</span>
        <span class="n">reference_mode</span><span class="o">=</span><span class="s2">"synonym"</span><span class="p">,</span>
        <span class="n">probability_mode</span><span class="o">=</span><span class="s2">"sigmoid"</span><span class="p">,</span>
        <span class="n">span_getter</span><span class="o">=</span><span class="p">[</span><span class="s2">"ents"</span><span class="p">],</span>
        <span class="n">embedding</span><span class="o">=</span><a href="../embeddings/span_pooler/#edsnlp.pipes.trainable.embeddings.span_pooler.factory.create_component">eds.span_pooler</a><span class="p">(</span>
            <span class="n">hidden_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">embedding</span><span class="o">=</span><a href="../embeddings/transformer/#edsnlp.pipes.trainable.embeddings.transformer.factory.create_component">eds.transformer</a><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">"prajjwal1/bert-tiny"</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
                <span class="n">stride</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"linker"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>We will assume you have a list of synonyms with their concept and label with the columns:</p> <ul> <li><code>STR</code>: synonym text</li> <li><code>CUI</code>: concept id</li> <li><code>GRP</code>: label.</li> </ul> <p>All we need to do is to initialize the component with the synonyms and that's it ! Since we have set <code>init_weights</code> to True, and we are in <code>synonym</code> mode, the embeddings of the synonyms will be stored in the component and used to compute the similarity scores</p> <div class="no-check highlight"><pre><span></span><code><span class="n">synonyms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"synonyms.csv"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_doc</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../reference/edsnlp/core/pipeline/#edsnlp.core.pipeline.Pipeline.make_doc">make_doc</a></body></html></span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">"STR"</span><span class="p">])</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[:]</span>
    <span class="n">span</span><span class="o">.</span><span class="n">label_</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">"GRP"</span><span class="p">]</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">=</span> <span class="p">[</span><span class="n">span</span><span class="p">]</span>
    <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">cui</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">"CUI"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">doc</span>

<span class="n">nlp</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../reference/edsnlp/core/pipeline/#edsnlp.core.pipeline.Pipeline.post_init">post_init</a></body></html></span><span class="p">(</span>
    <span class="n">edsnlp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../data/pandas/#edsnlp.data.pandas.from_pandas">from_pandas</a></body></html></span><span class="p">(</span>
        <span class="n">synonyms_df</span><span class="p">,</span>
        <span class="n">converter</span><span class="o">=</span><span class="n">make_doc</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div> <p>Now, you can now use it in a text: <div class="no-check highlight"><pre><span></span><code><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n"><html><head></head><body><a class="discrete-link" href="../../../reference/edsnlp/core/pipeline/#edsnlp.core.pipeline.Pipeline.make_doc">make_doc</a></body></html></span><span class="p">(</span><span class="s2">"Aspirin is a drug"</span><span class="p">)</span>
<span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># "Aspirin"</span>
<span class="n">span</span><span class="o">.</span><span class="n">label_</span> <span class="o">=</span> <span class="s2">"Drug"</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">=</span> <span class="p">[</span><span class="n">span</span><span class="p">]</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">cui</span><span class="p">)</span>
<span class="c1"># "B01AC06"</span>
</code></pre></div></p> <p>To use the <code><a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a></code> component in <code>class</code> mode, we refer to the following repository: <a href="https://github.com/percevalw/deep_multilingual_normalization">deep_multilingual_normalization</a> based on the work of <span><a class="citation" href="./#ref-wajsburt2021medical" id="edsnlp.pipes.trainable.span_linker.factory.create_component--cite-wajsburt2021medical">Wajsbürt et al., 2021</a></span>.</p> <h2 id="edsnlp.pipes.trainable.span_linker.factory.create_component--parameters">Parameters</h2> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>nlp</code></td> <td class="doc-param-details"> <p>Spacy vocabulary</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="edsnlp.core.PipelineProtocol">PipelineProtocol</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>Name of the component</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>str</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'span_linker'</code> </span> </p> </td> </tr> <tr> <td><code>embedding</code></td> <td class="doc-param-details"> <p>The word embedding component</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.pipes.trainable.embeddings.typing.SpanEmbeddingComponent">SpanEmbeddingComponent</span></code> </span> </p> </td> </tr> <tr> <td><code>metric</code></td> <td class="doc-param-details"> <p>Whether to compute the cosine similarity between the input and output embeddings or the dot product.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>Literal["cosine", "dot"] = "cosine"</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>cosine</code> </span> </p> </td> </tr> <tr> <td><code>rescale</code></td> <td class="doc-param-details"> <p>Rescale the output cosine similarities by a constant factor.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>float</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>20</code> </span> </p> </td> </tr> <tr> <td><code>threshold</code></td> <td class="doc-param-details"> <p>Threshold probability to consider a concept as valid</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>float</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>0.5</code> </span> </p> </td> </tr> <tr> <td><code>attribute</code></td> <td class="doc-param-details"> <p>The attribute to store the concept id</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>str</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>cui</code> </span> </p> </td> </tr> <tr> <td><code>reference_mode</code></td> <td class="doc-param-details"> <p>Whether to compare the embeddings with the concepts embeddings (one per concept) or the synonyms embeddings (one per concept per synonym). See above for more details.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing_extensions.Literal">Literal</span>['concept', 'synonym']</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>concept</code> </span> </p> </td> </tr> <tr> <td><code>span_getter</code></td> <td class="doc-param-details"> <p>How to extract the candidate spans to predict or train on.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-internal" href="../../../reference/edsnlp/utils/span_getters/#edsnlp.utils.span_getters.SpanGetterArg" title="edsnlp.utils.span_getters.SpanGetterArg">SpanGetterArg</a></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>context_getter</code></td> <td class="doc-param-details"> <p>What context to use when computing the span embeddings (defaults to the entity only, so no context)</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" href="../../../reference/edsnlp/utils/span_getters/#edsnlp.utils.span_getters.SpanGetterArg" title="edsnlp.utils.span_getters.SpanGetterArg">SpanGetterArg</a>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>probability_mode</code></td> <td class="doc-param-details"> <p>Whether to compute the probabilities using a softmax or a sigmoid function. This will also determine the loss function to use, either cross-entropy or binary cross-entropy.</p> <div class="admonition warning"> <p class="admonition-title">Subsetting the concepts</p> <p>The probabilities returned in <code>softmax</code> mode depend on the number of concepts (as an extreme cas, if you have only one concept, its softmax probability will always be 1). This is why we recommend using the <code>sigmoid</code> mode in which the probabilities are computed independently for each concept.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing_extensions.Literal">Literal</span>['softmax', 'sigmoid']</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>sigmoid</code> </span> </p> </td> </tr> <tr> <td><code>init_weights</code></td> <td class="doc-param-details"> <p>Whether to initialize the weights of the component with the embeddings of the entities of the docs provided to the <code>post_init</code> method. How this is done depends on the <code>reference_mode</code> parameter:</p> <ul> <li><code>concept</code>: the embeddings are averaged</li> <li><code>synonym</code>: the embeddings are stored as is</li> </ul> <p>By default, this is set to <code>True</code> if <code>reference_mode</code> is <code>synonym</code>, and <code>False</code> otherwise.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>bool</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> <h2 id="edsnlp.pipes.trainable.span_linker.factory.create_component--authors-and-citation">Authors and citation</h2> <p>The <code><a href="#edsnlp.pipes.trainable.span_linker.factory.create_component">eds.span_linker</a></code> component was developed by AP-HP's Data Science team.</p> <p>The deep learning concept-based architecture was adapted from <span><a class="citation" href="./#ref-wajsburt2021medical" id="edsnlp.pipes.trainable.span_linker.factory.create_component--cite-wajsburt2021medical">Wajsbürt et al., 2021</a></span>.</p> </div> </div> <div class="footnote"><hr/><ol><li id="ref-wajsburt2021medical"><p><p id="ref-wajsburt2021medical">Wajsbürt P., Sarfati A. and Tannier X., 2021. Medical concept normalization in French using multilingual terminologies and contextual embeddings. <i>Journal of Biomedical Informatics</i>. <i>114</i>, pp.103684. <a href="https://doi.org/10.1016/j.jbi.2021.103684" target="_blank">https://doi.org/10.1016/j.jbi.2021.103684</a></p></p></li></ol><div></div></div> <script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOG97JnM4CkS1h" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="title" data-reactions-enabled="1" data-repo="aphp/edsnlp" data-repo-id="R_kgDOG97JnA" data-strict="0" data-theme="https://aphp.github.io/edsnlp/master/assets/stylesheets/giscus_light.css" loading="lazy" src="https://giscus.app/client.js">
</script> <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate"
            ? "https://aphp.github.io/edsnlp/master/assets/stylesheets/giscus_dark.css"
            : "https://aphp.github.io/edsnlp/master/assets/stylesheets/giscus_light.css"

        // Instruct Giscus to set theme
        giscus.setAttribute("data-theme", theme)
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate"
                    ? "transparent_dark"
                    : "light"

                // Instruct Giscus to change theme
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    {giscus: {setConfig: {theme}}},
                    "https://giscus.app"
                )
            }
        })
    })
</script> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button class="md-top md-icon" data-md-component="top" hidden="" type="button"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: Span Classifier" class="md-footer__link md-footer__link--prev" href="../span-classifier/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> Span Classifier </div> </div> </a> <a aria-label="Next: Tokenizers" class="md-footer__link md-footer__link--next" href="../../../tokenizers/"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> Tokenizers </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.prune", "navigation.top", "navigation.footer", "content.code.annotate", "content.code.copy", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/vega@5"></script> <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script> <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script> <script src="../../../assets/termynal/termynal.js"></script> </body> </html>