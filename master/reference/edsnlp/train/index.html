<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><link href="../reducers/" rel="prev"/><link href="../training/" rel="next"/><link href="../../../assets/logo/edsnlp.svg" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.2.8" name="generator"/><title>train - EDS-NLP</title><link href="../../../assets/stylesheets/main.046329b4.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/palette.85d0ee34.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../../override.css" rel="stylesheet"/><link href="../../../assets/stylesheets/extra.css" rel="stylesheet"/><link href="../../../clickable-code.css" rel="stylesheet"/><link href="../../../cards.css" rel="stylesheet"/><link href="../../../pret.css" rel="stylesheet"/><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#edsnlptrain"> Skip to content </a> </div> <div data-md-component="announce"> <aside class="md-banner"> <div class="md-banner__inner md-grid md-typeset"> <button aria-label="Don't show this again" class="md-banner__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> Check out the new <a href="../../../tutorials/training-span-classifier">span classifier training tutorial</a> and the <a href="../../../tutorials/hpc">Slurm tutorial</a> ! </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <div data-md-color-scheme="default" data-md-component="outdated" hidden=""> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="EDS-NLP" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="EDS-NLP"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> EDS-NLP </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> train </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/aphp/edsnlp" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class="md-source__repository"> aphp/edsnlp </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="EDS-NLP" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="EDS-NLP"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> EDS-NLP </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/aphp/edsnlp" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class="md-source__repository"> aphp/edsnlp </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../.."> <span class="md-ellipsis"> Getting started </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="https://aphp.github.io/edsnlp/demo" target="_blank"> <span class="md-ellipsis"> Demo </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../tutorials/"> <span class="md-ellipsis"> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../pipes/"> <span class="md-ellipsis"> Pipes </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../tokenizers/"> <span class="md-ellipsis"> Tokenizers </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../data/"> <span class="md-ellipsis"> Data Connectors </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../training/training-api/"> <span class="md-ellipsis"> Training </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../concepts/pipeline/"> <span class="md-ellipsis"> Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../metrics/"> <span class="md-ellipsis"> Metrics </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../utilities/"> <span class="md-ellipsis"> Utilities </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/> <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0"> <span class="md-ellipsis"> Code Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> Code Reference </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_11_1" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> edsnlp </span> </a> <label class="md-nav__link" for="__nav_11_1"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="true" aria-labelledby="__nav_11_1_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_11_1"> <span class="md-nav__icon md-icon"></span> edsnlp </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../conjugator/"> <span class="md-ellipsis"> conjugator </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../connectors/"> <span class="md-ellipsis"> connectors </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../core/"> <span class="md-ellipsis"> core </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../data/"> <span class="md-ellipsis"> data </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../evaluate/"> <span class="md-ellipsis"> evaluate </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../extensions/"> <span class="md-ellipsis"> extensions </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../language/"> <span class="md-ellipsis"> language </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../matchers/"> <span class="md-ellipsis"> matchers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../metrics/"> <span class="md-ellipsis"> metrics </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../package/"> <span class="md-ellipsis"> package </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../patch_spacy/"> <span class="md-ellipsis"> patch_spacy </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../pipes/"> <span class="md-ellipsis"> pipes </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../processing/"> <span class="md-ellipsis"> processing </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../reducers/"> <span class="md-ellipsis"> reducers </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> train </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> train </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline"> Pipeline </a> <nav aria-label="Pipeline" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline--parameters"> Parameters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.disabled"> disabled </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.cfg"> cfg </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe"> get_pipe() </a> <nav aria-label="get_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.has_pipe"> has_pipe() </a> <nav aria-label="has_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.has_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.create_pipe"> create_pipe() </a> <nav aria-label="create_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.create_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.add_pipe"> add_pipe() </a> <nav aria-label="add_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.add_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe_meta"> get_pipe_meta() </a> <nav aria-label="get_pipe_meta()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe_meta--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.make_doc"> make_doc() </a> <nav aria-label="make_doc()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.make_doc--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.__call__"> __call__() </a> <nav aria-label="__call__()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.__call__--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.pipe"> pipe() </a> <nav aria-label="pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.cache"> cache() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.torch_components"> torch_components() </a> <nav aria-label="torch_components()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.torch_components--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.connected_pipes_names"> connected_pipes_names() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.post_init"> post_init() </a> <nav aria-label="post_init()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.post_init--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_config"> from_config() </a> <nav aria-label="from_config()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_config--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.validate"> validate() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.preprocess_many"> preprocess_many() </a> <nav aria-label="preprocess_many()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.preprocess_many--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.collate"> collate() </a> <nav aria-label="collate()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.collate--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.parameters"> parameters() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.named_parameters"> named_parameters() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to"> to() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.train"> train() </a> <nav aria-label="train()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.train--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to_disk"> to_disk() </a> <nav aria-label="to_disk()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to_disk--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_disk"> from_disk() </a> <nav aria-label="from_disk()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_disk--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.select_pipes"> select_pipes() </a> <nav aria-label="select_pipes()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.select_pipes--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream"> Stream </a> <nav aria-label="Stream" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.set_processing"> set_processing() </a> <nav aria-label="set_processing()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.set_processing--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map"> map() </a> <nav aria-label="map()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.flatten"> flatten() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_batches"> map_batches() </a> <nav aria-label="map_batches()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_batches--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.batchify"> batchify() </a> <nav aria-label="batchify()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.batchify--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_gpu"> map_gpu() </a> <nav aria-label="map_gpu()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_gpu--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_pipeline"> map_pipeline() </a> <nav aria-label="map_pipeline()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_pipeline--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.shuffle"> shuffle() </a> <nav aria-label="shuffle()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.shuffle--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.loop"> loop() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.torch_components"> torch_components() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.train"> train() </a> <nav aria-label="train()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.train--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.eval"> eval() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric"> SpanAttributeMetric </a> <nav aria-label="SpanAttributeMetric" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric--parameters"> Parameters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric.__call__"> __call__() </a> <nav aria-label="__call__()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric.__call__--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.BatchSizeArg"> BatchSizeArg </a> <nav aria-label="BatchSizeArg" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.BatchSizeArg--examples"> Examples </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent"> TorchComponent </a> <nav aria-label="TorchComponent" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.post_init"> post_init() </a> <nav aria-label="post_init()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.post_init--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess"> preprocess() </a> <nav aria-label="preprocess()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.collate"> collate() </a> <nav aria-label="collate()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.collate--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_to_device"> batch_to_device() </a> <nav aria-label="batch_to_device()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_to_device--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.forward"> forward() </a> <nav aria-label="forward()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.forward--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.compute_training_metrics"> compute_training_metrics() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.module_forward"> module_forward() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.prepare_batch"> prepare_batch() </a> <nav aria-label="prepare_batch()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.prepare_batch--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_process"> batch_process() </a> <nav aria-label="batch_process()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_process--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.postprocess"> postprocess() </a> <nav aria-label="postprocess()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.postprocess--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess_supervised"> preprocess_supervised() </a> <nav aria-label="preprocess_supervised()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess_supervised--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.pipe"> pipe() </a> <nav aria-label="pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.LinearSchedule"> LinearSchedule </a> <nav aria-label="LinearSchedule" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.LinearSchedule--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer"> ScheduledOptimizer </a> <nav aria-label="ScheduledOptimizer" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer--examples"> Examples </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.GenericScorer"> GenericScorer </a> <nav aria-label="GenericScorer" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.GenericScorer--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TrainingData"> TrainingData </a> <nav aria-label="TrainingData" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TrainingData--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.stat_batchify"> stat_batchify() </a> <nav aria-label="stat_batchify()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.stat_batchify--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.decompress_dict"> decompress_dict() </a> <nav aria-label="decompress_dict()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.decompress_dict--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ld_to_dl"> ld_to_dl() </a> <nav aria-label="ld_to_dl()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ld_to_dl--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../training/"> <span class="md-ellipsis"> training </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../tune/"> <span class="md-ellipsis"> tune </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../utils/"> <span class="md-ellipsis"> utils </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../viz/"> <span class="md-ellipsis"> viz </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../contributing/"> <span class="md-ellipsis"> Contributing to EDS-NLP </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../changelog/"> <span class="md-ellipsis"> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline"> Pipeline </a> <nav aria-label="Pipeline" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline--parameters"> Parameters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.disabled"> disabled </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.cfg"> cfg </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe"> get_pipe() </a> <nav aria-label="get_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.has_pipe"> has_pipe() </a> <nav aria-label="has_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.has_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.create_pipe"> create_pipe() </a> <nav aria-label="create_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.create_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.add_pipe"> add_pipe() </a> <nav aria-label="add_pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.add_pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe_meta"> get_pipe_meta() </a> <nav aria-label="get_pipe_meta()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.get_pipe_meta--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.make_doc"> make_doc() </a> <nav aria-label="make_doc()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.make_doc--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.__call__"> __call__() </a> <nav aria-label="__call__()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.__call__--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.pipe"> pipe() </a> <nav aria-label="pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.cache"> cache() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.torch_components"> torch_components() </a> <nav aria-label="torch_components()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.torch_components--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.connected_pipes_names"> connected_pipes_names() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.post_init"> post_init() </a> <nav aria-label="post_init()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.post_init--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_config"> from_config() </a> <nav aria-label="from_config()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_config--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.validate"> validate() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.preprocess_many"> preprocess_many() </a> <nav aria-label="preprocess_many()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.preprocess_many--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.collate"> collate() </a> <nav aria-label="collate()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.collate--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.parameters"> parameters() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.named_parameters"> named_parameters() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to"> to() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.train"> train() </a> <nav aria-label="train()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.train--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to_disk"> to_disk() </a> <nav aria-label="to_disk()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.to_disk--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_disk"> from_disk() </a> <nav aria-label="from_disk()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.from_disk--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.select_pipes"> select_pipes() </a> <nav aria-label="select_pipes()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Pipeline.select_pipes--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream"> Stream </a> <nav aria-label="Stream" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.set_processing"> set_processing() </a> <nav aria-label="set_processing()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.set_processing--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map"> map() </a> <nav aria-label="map()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.flatten"> flatten() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_batches"> map_batches() </a> <nav aria-label="map_batches()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_batches--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.batchify"> batchify() </a> <nav aria-label="batchify()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.batchify--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_gpu"> map_gpu() </a> <nav aria-label="map_gpu()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_gpu--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_pipeline"> map_pipeline() </a> <nav aria-label="map_pipeline()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.map_pipeline--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.shuffle"> shuffle() </a> <nav aria-label="shuffle()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.shuffle--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.loop"> loop() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.torch_components"> torch_components() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.train"> train() </a> <nav aria-label="train()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.train--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.Stream.eval"> eval() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric"> SpanAttributeMetric </a> <nav aria-label="SpanAttributeMetric" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric--parameters"> Parameters </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric.__call__"> __call__() </a> <nav aria-label="__call__()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.SpanAttributeMetric.__call__--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.BatchSizeArg"> BatchSizeArg </a> <nav aria-label="BatchSizeArg" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.BatchSizeArg--examples"> Examples </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent"> TorchComponent </a> <nav aria-label="TorchComponent" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.post_init"> post_init() </a> <nav aria-label="post_init()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.post_init--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess"> preprocess() </a> <nav aria-label="preprocess()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.collate"> collate() </a> <nav aria-label="collate()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.collate--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_to_device"> batch_to_device() </a> <nav aria-label="batch_to_device()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_to_device--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.forward"> forward() </a> <nav aria-label="forward()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.forward--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.compute_training_metrics"> compute_training_metrics() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.module_forward"> module_forward() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.prepare_batch"> prepare_batch() </a> <nav aria-label="prepare_batch()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.prepare_batch--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_process"> batch_process() </a> <nav aria-label="batch_process()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.batch_process--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.postprocess"> postprocess() </a> <nav aria-label="postprocess()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.postprocess--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess_supervised"> preprocess_supervised() </a> <nav aria-label="preprocess_supervised()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.preprocess_supervised--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.pipe"> pipe() </a> <nav aria-label="pipe()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TorchComponent.pipe--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.LinearSchedule"> LinearSchedule </a> <nav aria-label="LinearSchedule" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.LinearSchedule--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer"> ScheduledOptimizer </a> <nav aria-label="ScheduledOptimizer" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer--examples"> Examples </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ScheduledOptimizer--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.GenericScorer"> GenericScorer </a> <nav aria-label="GenericScorer" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.GenericScorer--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TrainingData"> TrainingData </a> <nav aria-label="TrainingData" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.TrainingData--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.stat_batchify"> stat_batchify() </a> <nav aria-label="stat_batchify()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.stat_batchify--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.decompress_dict"> decompress_dict() </a> <nav aria-label="decompress_dict()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.decompress_dict--parameters"> Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ld_to_dl"> ld_to_dl() </a> <nav aria-label="ld_to_dl()" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#edsnlp.train.ld_to_dl--parameters"> Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="edsnlptrain"><code>edsnlp.train</code></h1> <div class="doc doc-object doc-module"> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.Pipeline"> <code class="highlight language-python"><span class="n">Pipeline</span></code> </h2> <div class="doc doc-contents"> <p class="doc doc-class-bases"> Bases: <code><span title="edsnlp.utils.typing.Validated">Validated</span></code></p> <p>New pipeline to use as a drop-in replacement for spaCy's pipeline. It uses PyTorch as the deep-learning backend and allows components to share subcomponents.</p> <p>See the documentation for more details.</p> <h3 id="edsnlp.train.Pipeline--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>lang</code></td> <td class="doc-param-details"> <p>Language code</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> <tr> <td><code>create_tokenizer</code></td> <td class="doc-param-details"> <p>Function that creates a tokenizer for the pipeline</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="typing_extensions.Self">Self</span>], <span title="spacy.tokenizer.Tokenizer">Tokenizer</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>vocab</code></td> <td class="doc-param-details"> <p>Whether to create a new vocab or use an existing one</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="spacy.vocab.Vocab">Vocab</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr> <td><code>vocab_config</code></td> <td class="doc-param-details"> <p>Configuration for the vocab</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Type">Type</span>[<span title="spacy.language.BaseDefaults">BaseDefaults</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>meta</code></td> <td class="doc-param-details"> <p>Meta information about the pipeline</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.disabled"> <code class="highlight language-python"><span class="n">disabled</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents"> <p>The names of the disabled components</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.cfg"> <code class="highlight language-python"><span class="n">cfg</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents"> <p>Returns the config of the pipeline, including the config of all components. Updated from spacy to allow references between components.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.get_pipe"> <code class="highlight language-python"><span class="n">get_pipe</span></code> </h3> <div class="doc doc-contents"> <p>Get a component by its name.</p> <h4 id="edsnlp.train.Pipeline.get_pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>The name of the component to get.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.pipeline.Pipe">Pipe</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.has_pipe"> <code class="highlight language-python"><span class="n">has_pipe</span></code> </h3> <div class="doc doc-contents"> <p>Check if a component exists in the pipeline.</p> <h4 id="edsnlp.train.Pipeline.has_pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>The name of the component to check.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="bool">bool</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.create_pipe"> <code class="highlight language-python"><span class="n">create_pipe</span></code> </h3> <div class="doc doc-contents"> <p>Create a component from a factory name.</p> <h4 id="edsnlp.train.Pipeline.create_pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>factory</code></td> <td class="doc-param-details"> <p>The name of the factory to use</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>The name of the component</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> <tr> <td><code>config</code></td> <td class="doc-param-details"> <p>The config to pass to the factory</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.pipeline.Pipe">Pipe</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.add_pipe"> <code class="highlight language-python"><span class="n">add_pipe</span></code> </h3> <div class="doc doc-contents"> <p>Add a component to the pipeline.</p> <h4 id="edsnlp.train.Pipeline.add_pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>factory</code></td> <td class="doc-param-details"> <p>The name of the component to add or the component itself</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="edsnlp.core.pipeline.Pipe">Pipe</span>]</code> </span> </p> </td> </tr> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>The name of the component. If not provided, the name of the component will be used if it has one (.name), otherwise the factory name will be used.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>first</code></td> <td class="doc-param-details"> <p>Whether to add the component to the beginning of the pipeline. This argument is mutually exclusive with <code>before</code> and <code>after</code>.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr> <td><code>before</code></td> <td class="doc-param-details"> <p>The name of the component to add the new component before. This argument is mutually exclusive with <code>after</code> and <code>first</code>.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>after</code></td> <td class="doc-param-details"> <p>The name of the component to add the new component after. This argument is mutually exclusive with <code>before</code> and <code>first</code>.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>config</code></td> <td class="doc-param-details"> <p>The arguments to pass to the component factory.</p> <p>Note that instead of replacing arguments with the same keys, the config will be merged with the default config of the component. This means that you can override specific nested arguments without having to specify the entire config.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.pipeline.Pipe">Pipe</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>The component that was added to the pipeline.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.get_pipe_meta"> <code class="highlight language-python"><span class="n">get_pipe_meta</span></code> </h3> <div class="doc doc-contents"> <p>Get the meta information for a component.</p> <h4 id="edsnlp.train.Pipeline.get_pipe_meta--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>name</code></td> <td class="doc-param-details"> <p>The name of the component to get the meta for.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.make_doc"> <code class="highlight language-python"><span class="n">make_doc</span></code> </h3> <div class="doc doc-contents"> <p>Create a Doc from text.</p> <h4 id="edsnlp.train.Pipeline.make_doc--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>text</code></td> <td class="doc-param-details"> <p>The text to create the Doc from.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="spacy.tokens.Doc">Doc</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.__call__"> <code class="highlight language-python"><span class="fm">__call__</span></code> </h3> <div class="doc doc-contents"> <p>Apply each component successively on a document.</p> <h4 id="edsnlp.train.Pipeline.__call__--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>text</code></td> <td class="doc-param-details"> <p>The text to create the Doc from, or a Doc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="spacy.tokens.Doc">Doc</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.pipe"> <code class="highlight language-python"><span class="n">pipe</span></code> </h3> <div class="doc doc-contents"> <p>Process a stream of documents by applying each component successively on batches of documents.</p> <h4 id="edsnlp.train.Pipeline.pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>inputs</code></td> <td class="doc-param-details"> <p>The inputs to create the Docs from, or Docs directly.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="typing.Iterable">Iterable</span>, <a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a>]</code> </span> </p> </td> </tr> <tr> <td><code>n_process</code></td> <td class="doc-param-details"> <p>Deprecated. Use the ".set_processing(num_cpu_workers=n_process)" method on the returned data stream instead. The number of parallel workers to use. If 0, the operations will be executed sequentially.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="int">int</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.cache"> <code class="highlight language-python"><span class="n">cache</span></code> </h3> <div class="doc doc-contents"> <p>Enable caching for all (trainable) components in the pipeline</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.torch_components"> <code class="highlight language-python"><span class="n">torch_components</span></code> </h3> <div class="doc doc-contents"> <p>Yields components that are PyTorch modules.</p> <h4 id="edsnlp.train.Pipeline.torch_components--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>disable</code></td> <td class="doc-param-details"> <p>The names of disabled components, which will be skipped.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Container">Container</span>[<span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>()</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Iterable">Iterable</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" href="../../../concepts/torch-component/#edsnlp.core.torch_component.TorchComponent" title="Torch Component (edsnlp.core.torch_component.TorchComponent)">TorchComponent</a>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.connected_pipes_names"> <code class="highlight language-python"><span class="n">connected_pipes_names</span></code> </h3> <div class="doc doc-contents"> <p>Returns a list of lists of connected components in the pipeline, i.e. components that share at least one parameter.</p> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.post_init"> <code class="highlight language-python"><span class="n">post_init</span></code> </h3> <div class="doc doc-contents"> <p>Completes the initialization of the pipeline by calling the post_init method of all components that have one. This is useful for components that need to see some data to build their vocabulary, for instance.</p> <h4 id="edsnlp.train.Pipeline.post_init--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>data</code></td> <td class="doc-param-details"> <p>The documents to use for initialization. Each component will not necessarily see all the data.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>exclude</code></td> <td class="doc-param-details"> <p>Components to exclude from post initialization on data</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.from_config"> <code class="highlight language-python"><span class="n">from_config</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Create a pipeline from a config object</p> <h4 id="edsnlp.train.Pipeline.from_config--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>config</code></td> <td class="doc-param-details"> <p>The config to use</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>], <a class="autorefs autorefs-internal" href="../../../concepts/pipeline/#edsnlp.core.pipeline.Pipeline" title="Pipeline (edsnlp.core.pipeline.Pipeline)">Pipeline</a>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>{}</code> </span> </p> </td> </tr> <tr> <td><code>vocab</code></td> <td class="doc-param-details"> <p>The spaCy vocab to use. If True, a new vocab will be created</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="spacy.vocab.Vocab">Vocab</span>, <span title="bool">bool</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr> <td><code>disable</code></td> <td class="doc-param-details"> <p>Components to disable</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><span title="edsnlp.core.pipeline.EMPTY_LIST">EMPTY_LIST</span></code> </span> </p> </td> </tr> <tr> <td><code>enable</code></td> <td class="doc-param-details"> <p>Components to enable</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><span title="edsnlp.core.pipeline.EMPTY_LIST">EMPTY_LIST</span></code> </span> </p> </td> </tr> <tr> <td><code>exclude</code></td> <td class="doc-param-details"> <p>Components to exclude</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><span title="edsnlp.core.pipeline.EMPTY_LIST">EMPTY_LIST</span></code> </span> </p> </td> </tr> <tr> <td><code>meta</code></td> <td class="doc-param-details"> <p>Metadata to add to the pipeline</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><a class="autorefs autorefs-internal" href="../utils/collections/#edsnlp.utils.collections.FrozenDict" title="FrozenDict (edsnlp.utils.collections.FrozenDict)">FrozenDict</a>()</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/pipeline/#edsnlp.core.pipeline.Pipeline" title="Pipeline (edsnlp.core.pipeline.Pipeline)">Pipeline</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.validate"> <code class="highlight language-python"><span class="n">validate</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Pydantic validator, used in the <code>validate_arguments</code> decorated functions</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.preprocess_many"> <code class="highlight language-python"><span class="n">preprocess_many</span></code> </h3> <div class="doc doc-contents"> <p>Runs the preprocessing methods of each component in the pipeline on a collection of documents and returns an iterable of dictionaries containing the results, with the component names as keys.</p> <h4 id="edsnlp.train.Pipeline.preprocess_many--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>docs</code></td> <td class="doc-param-details"> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>compress</code></td> <td class="doc-param-details"> <p>Whether to deduplicate identical preprocessing outputs of the results if multiple documents share identical subcomponents. This step is required to enable the cache mechanism when training or running the pipeline over a tabular datasets such as pyarrow tables that do not store referential equality information.</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr> <td><code>supervision</code></td> <td class="doc-param-details"> <p>Whether to include supervision information in the preprocessing</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.collate"> <code class="highlight language-python"><span class="n">collate</span></code> </h3> <div class="doc doc-contents"> <p>Collates a batch of preprocessed samples into a single (maybe nested) dictionary of tensors by calling the collate method of each component.</p> <h4 id="edsnlp.train.Pipeline.collate--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch</code></td> <td class="doc-param-details"> <p>The batch of preprocessed samples</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="typing.Iterable">Iterable</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code> </span> </p> </td> </tr> <tr> <td><code>device</code></td> <td class="doc-param-details"> <p>Should we move the tensors to a device, if so, which one?</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="torch.device">device</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>The collated batch</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.parameters"> <code class="highlight language-python"><span class="n">parameters</span></code> </h3> <div class="doc doc-contents"> <p>Returns an iterator over the Pytorch parameters of the components in the pipeline</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.named_parameters"> <code class="highlight language-python"><span class="n">named_parameters</span></code> </h3> <div class="doc doc-contents"> <p>Returns an iterator over the Pytorch parameters of the components in the pipeline</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.to"> <code class="highlight language-python"><span class="n">to</span></code> </h3> <div class="doc doc-contents"> <p>Moves the pipeline to a given device</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.train"> <code class="highlight language-python"><span class="n">train</span></code> </h3> <div class="doc doc-contents"> <p>Enables training mode on pytorch modules</p> <h4 id="edsnlp.train.Pipeline.train--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>mode</code></td> <td class="doc-param-details"> <p>Whether to enable training or not</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.to_disk"> <code class="highlight language-python"><span class="n">to_disk</span></code> </h3> <div class="doc doc-contents"> <p>Save the pipeline to a directory.</p> <h4 id="edsnlp.train.Pipeline.to_disk--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td class="doc-param-details"> <p>The path to the directory to save the pipeline to. Every component will be saved to separated subdirectories of this directory, except for tensors that will be saved to a shared files depending on the references between the components.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code> </span> </p> </td> </tr> <tr> <td><code>exclude</code></td> <td class="doc-param-details"> <p>The names of the components, or attributes to exclude from the saving process. By default, the vocabulary is excluded since it may contain personal identifiers and can be rebuilt during inference.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.from_disk"> <code class="highlight language-python"><span class="n">from_disk</span></code> </h3> <div class="doc doc-contents"> <p>Load the pipeline from a directory. Components will be updated in-place.</p> <h4 id="edsnlp.train.Pipeline.from_disk--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td class="doc-param-details"> <p>The path to the directory to load the pipeline from</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code> </span> </p> </td> </tr> <tr> <td><code>exclude</code></td> <td class="doc-param-details"> <p>The names of the components, or attributes to exclude from the loading process.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Sequence">Sequence</span>[<span title="str">str</span>]]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>device</code></td> <td class="doc-param-details"> <p>Device to use when loading the tensors</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="torch.device">device</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'cpu'</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.Pipeline.select_pipes"> <code class="highlight language-python"><span class="n">select_pipes</span></code> </h3> <div class="doc doc-contents"> <p>Temporarily disable and enable components in the pipeline.</p> <h4 id="edsnlp.train.Pipeline.select_pipes--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>disable</code></td> <td class="doc-param-details"> <p>The name of the component to disable, or a list of names.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>enable</code></td> <td class="doc-param-details"> <p>The name of the component to enable, or a list of names.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Iterable">Iterable</span>[<span title="str">str</span>]]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream"> <code class="highlight language-python"><span class="n">Stream</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L278" target="_blank">[source]</a></h2> <div class="doc doc-contents"> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.set_processing"> <code class="highlight language-python"><span class="n">set_processing</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L362" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <h4 id="edsnlp.train.Stream.set_processing--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.utils.batching.BatchBy">BatchBy</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>num_cpu_workers</code></td> <td class="doc-param-details"> <p>Number of CPU workers. A CPU worker handles the non deep-learning components and the preprocessing, collating and postprocessing of deep-learning components. If no GPU workers are used, the CPU workers also handle the forward call of the deep-learning components.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>num_gpu_workers</code></td> <td class="doc-param-details"> <p>Number of GPU workers. A GPU worker handles the forward call of the deep-learning components. Only used with "multiprocessing" backend.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>disable_implicit_parallelism</code></td> <td class="doc-param-details"> <p>Whether to disable OpenMP and Huggingface tokenizers implicit parallelism in multiprocessing mode. Defaults to True.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr> <td><code>backend</code></td> <td class="doc-param-details"> <p>The backend to use for parallel processing. If not set, the backend is automatically selected based on the input data and the number of workers.</p> <ul> <li>"simple" is the default backend and is used when <code>num_cpu_workers</code> is 1 and <code>num_gpu_workers</code> is 0.</li> <li>"multiprocessing" is used when <code>num_cpu_workers</code> is greater than 1 or <code>num_gpu_workers</code> is greater than 0.</li> <li>"spark" is used when the input data is a Spark dataframe and the output writer is a Spark writer.</li> </ul> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing_extensions.Literal">Literal</span>['simple', 'multiprocessing', 'mp', 'spark']]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>autocast</code></td> <td class="doc-param-details"> <p>Whether to use <a href="https://pytorch.org/docs/stable/amp.html">automatic mixed precision (AMP)</a> for the forward pass of the deep-learning components. If True (by default), AMP will be used with the default settings. If False, AMP will not be used. If a dtype is provided, it will be passed to the <code>torch.autocast</code> context manager.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>show_progress</code></td> <td class="doc-param-details"> <p>Whether to show progress bars (only applicable with "simple" and "multiprocessing" backends).</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr> <td><code>gpu_pipe_names</code></td> <td class="doc-param-details"> <p>List of pipe names to accelerate on a GPUWorker, defaults to all pipes that inherit from TorchComponent. Only used with "multiprocessing" backend. Inferred from the pipeline if not set.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>process_start_method</code></td> <td class="doc-param-details"> <p>Whether to use "fork" or "spawn" as the start method for the multiprocessing backend. The default is "fork" on Unix systems and "spawn" on Windows.</p> <ul> <li>"fork" is the default start method on Unix systems and is the fastest start method, but it is not available on Windows, can cause issues with CUDA and is not safe when using multiple threads.</li> <li>"spawn" is the default start method on Windows and is the safest start method, but it is not available on Unix systems and is slower than "fork".</li> </ul> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing_extensions.Literal">Literal</span>['fork', 'spawn']]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>gpu_worker_devices</code></td> <td class="doc-param-details"> <p>List of GPU devices to use for the GPU workers. Defaults to all available devices, one worker per device. Only used with "multiprocessing" backend.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>cpu_worker_devices</code></td> <td class="doc-param-details"> <p>List of GPU devices to use for the CPU workers. Used for debugging purposes.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>deterministic</code></td> <td class="doc-param-details"> <p>Whether to try and preserve the order of the documents in "multiprocessing" mode. If set to <code>False</code>, workers will process documents whenever they are available in a dynamic fashion, which may result in out-of-order but usually faster processing. If set to true, tasks will be distributed in a static, round-robin fashion to workers. Defaults to <code>True</code>.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.map"> <code class="highlight language-python"><span class="nb">map</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L489" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Maps a callable to the documents. It takes a callable as input and an optional dictionary of keyword arguments. The function will be applied to each element of the collection. If the callable is a generator function, each element will be yielded to the stream as is.</p> <h4 id="edsnlp.train.Stream.map--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>pipe</code></td> <td class="doc-param-details"> <p>The callable to map to the documents.</p> <p> </p> </td> </tr> <tr> <td><code>kwargs</code></td> <td class="doc-param-details"> <p>The keyword arguments to pass to the callable.</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>{}</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.flatten"> <code class="highlight language-python"><span class="n">flatten</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L514" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Flattens the stream.</p> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.map_batches"> <code class="highlight language-python"><span class="n">map_batches</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L529" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Maps a callable to a batch of documents. The callable should take a list of inputs. The output of the callable will be flattened if it is a list or a generator, or yielded to the stream as is if it is a single output (tuple or any other type).</p> <h4 id="edsnlp.train.Stream.map_batches--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>pipe</code></td> <td class="doc-param-details"> <p>The callable to map to the documents.</p> <p> </p> </td> </tr> <tr> <td><code>kwargs</code></td> <td class="doc-param-details"> <p>The keyword arguments to pass to the callable.</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>{}</code> </span> </p> </td> </tr> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.utils.batching.BatchBy">BatchBy</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.batchify"> <code class="highlight language-python"><span class="n">batchify</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L581" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Accumulates the documents into batches and yield each batch to the stream.</p> <h4 id="edsnlp.train.Stream.batchify--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.utils.batching.BatchBy">BatchBy</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.map_gpu"> <code class="highlight language-python"><span class="n">map_gpu</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L617" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Maps a deep learning operation to a batch of documents, on a GPU worker.</p> <h4 id="edsnlp.train.Stream.map_gpu--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>prepare_batch</code></td> <td class="doc-param-details"> <p>A callable that takes a list of documents and a device and returns a batch of tensors (or anything that can be passed to the <code>forward</code> callable). This will be called on a CPU-bound worker, and may be parallelized.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Callable">Callable</span>[[<span title="typing.List">List</span>, <span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="torch.device">device</span>]], <span title="typing.Any">Any</span>]</code> </span> </p> </td> </tr> <tr> <td><code>forward</code></td> <td class="doc-param-details"> <p>A callable that takes the output of <code>prepare_batch</code> and returns the output of the deep learning operation. This will be called on a GPU-bound worker.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Callable">Callable</span>[[<span title="typing.Any">Any</span>], <span title="typing.Any">Any</span>]</code> </span> </p> </td> </tr> <tr> <td><code>postprocess</code></td> <td class="doc-param-details"> <p>An optional callable that takes the list of documents and the output of the deep learning operation, and returns the final output. This will be called on the same CPU-bound worker that called the <code>prepare_batch</code> function.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="typing.List">List</span>, <span title="typing.Any">Any</span>], <span title="typing.Any">Any</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.utils.batching.BatchBy">BatchBy</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.map_pipeline"> <code class="highlight language-python"><span class="n">map_pipeline</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L675" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Maps a pipeline to the documents, i.e. adds each component of the pipeline to the stream operations. This function is called under the hood by <code>nlp.pipe()</code></p> <h4 id="edsnlp.train.Stream.map_pipeline--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>model</code></td> <td class="doc-param-details"> <p>The pipeline to map to the documents.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-internal" href="../core/pipeline/#edsnlp.core.pipeline.Pipeline" title="Pipeline (edsnlp.Pipeline)">Pipeline</a></code> </span> </p> </td> </tr> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.utils.batching.BatchBy">BatchBy</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.shuffle"> <code class="highlight language-python"><span class="n">shuffle</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L765" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Shuffles the stream by accumulating the documents into batches and shuffling the batches. We try to optimize and avoid the accumulation by shuffling items directly in the reader, but if some upstream operations are not elementwise or if the reader is not compatible with the batching mode, we have to accumulate the documents into batches and shuffle the batches.</p> <p>For instance, imagine a reading from list of 2 very large documents and applying an operation to split the documents into sentences. Shuffling only in the reader, then applying the split operation would not shuffle the sentences across documents and may lead to a lack of randomness when training a model. Think of this as having lumps after mixing your data. In our case, we detect that the split op is not elementwise and trigger the accumulation of sentences into batches after their generation before shuffling the batches.</p> <h4 id="edsnlp.train.Stream.shuffle--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can also be a batching expression like "32 docs", "1024 words", "dataset", "fragment", etc.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>batch_by</code></td> <td class="doc-param-details"> <p>Function to compute the batches. If set, it should take an iterable of documents and return an iterable of batches. You can also set it to "docs", "words" or "padded_words" to use predefined batching functions. Defaults to "docs".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>, <span title="edsnlp.utils.batching.BatchFn">BatchFn</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>seed</code></td> <td class="doc-param-details"> <p>The seed to use for shuffling.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>shuffle_reader</code></td> <td class="doc-param-details"> <p>Whether to shuffle the reader. Defaults to True if the reader is compatible with the batch_by mode, False otherwise.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.loop"> <code class="highlight language-python"><span class="n">loop</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L852" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Loops over the stream indefinitely.</p> <p>Note that we cycle over items produced by the reader, not the items produced by the stream operations. This means that the stream operations will be applied to the same items multiple times, and may produce different results if they are non-deterministic. This also mean that calling this function will have the same effect regardless of the operations applied to the stream before calling it, ie:</p> <div class="highlight"><pre><span></span><code>stream.loop().map(...)
# is equivalent to
stream.map(...).loop()
</code></pre></div> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.torch_components"> <code class="highlight language-python"><span class="n">torch_components</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L926" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Yields components that are PyTorch modules.</p> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Iterable">Iterable</span>['edsnlp.core.torch_component.TorchComponent']</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.train"> <code class="highlight language-python"><span class="n">train</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L938" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Enables training mode on pytorch modules</p> <h4 id="edsnlp.train.Stream.train--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>mode</code></td> <td class="doc-param-details"> <p>Whether to enable training or not</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.Stream.eval"> <code class="highlight language-python"><span class="nb">eval</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/stream.py#L963" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Enables evaluation mode on pytorch modules</p> </div> </div> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.SpanAttributeMetric"> <code class="highlight language-python"><span class="n">SpanAttributeMetric</span></code> </h2> <div class="doc doc-contents"> <p>The <code>eds.span_attribute</code> metric evaluates spanlevel attribute classification by comparing predicted and gold attribute values on the same set of spans. For each attribute you specify, it computes Precision, Recall, F1, number of true positives (tp), number of gold instances (support), number of predicted instances (positives), and the Average Precision (ap). A microaverage over all attributes is also provided under <code>micro_key</code>.</p> <div class="no-check highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">edsnlp.metrics.span_attribute</span><span class="w"> </span><span class="kn">import</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../../metrics/span-attribute/#edsnlp.metrics.span_attribute.SpanAttributeMetric">SpanAttributeMetric</a></body></html></span>

<span class="n">metric</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../../metrics/span-attribute/#edsnlp.metrics.span_attribute.SpanAttributeMetric">SpanAttributeMetric</a></body></html></span><span class="p">(</span>
    <span class="n">span_getter</span><span class="o">=</span><span class="n">conv</span><span class="o">.</span><span class="n">span_setter</span><span class="p">,</span>
    <span class="c1"># Evaluated attributes</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"neg"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># 'neg' on every entity</span>
        <span class="s2">"carrier"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"DIS"</span><span class="p">],</span>  <span class="c1"># 'carrier' only on 'DIS' entities</span>
    <span class="p">},</span>
    <span class="c1"># Ignore these default values when counting matches</span>
    <span class="n">default_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"neg"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">micro_key</span><span class="o">=</span><span class="s2">"micro"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>Let's enumerate (span -&gt; attr = value) items in our documents. Only the items with matching span boundaries, attribute name, and value are counted as a true positives. For instance, with the predicted and reference spans of the example above:</p> <table> <thead> <tr> <th colspan="1" rowspan="1"> <p>pred</p> </th> <th colspan="1" rowspan="1"> <p>ref</p> </th> </tr> </thead> <tbody> <tr> <td colspan="1" rowspan="1"> <p><em class="chip tp">fivreux  neg = True</em><br/> <em class="chip na">du diabte  neg = False</em><br/> <em class="chip fp">du diabte  carrier = PATIENT</em><br/> <em class="chip fp">cancer  neg = True</em><br/> <em class="chip tp">cancer  carrier = PATIENT</em></p> </td> <td colspan="1" rowspan="1"> <p><em class="chip tp">fivreux  neg = True</em><br/> <em class="chip na">du diabte  neg = False</em><br/> <em class="chip fn">du diabte  carrier = FATHER</em><br/> <em class="chip na">cancer  neg = False</em><br/> <em class="chip tp">cancer  carrier = PATIENT</em></p> </td> </tr> </tbody> </table> <div class="admonition note"> <p class="admonition-title">Default values</p> <p>Note that there we don't count "neg=False" items, shown in grey in the table. In EDS-NLP, this is done by setting <code>defaults_values={"neg": False}</code> when creating the metric. This is quite common in classification tasks, where one of the values is both the most common and the "default" (hence the name of the parameter). Counting these values would likely skew the micro-average metrics towards the default value.</p> </div> <p>Precision, Recall and F1 (micro-average and perlabel) are computed as follows:</p> <ul> <li>Precision: <code>p = |matched items of pred| / |pred|</code></li> <li>Recall: <code>r = |matched items of ref| / |ref|</code></li> <li>F1: <code>f = 2 / (1/p + 1/f)</code></li> </ul> <p>This yields the following metrics:</p> <div class="highlight"><pre><span></span><code><span class="n">metric</span><span class="p">([</span><span class="n">ref</span><span class="p">],</span> <span class="p">[</span><span class="n">pred</span><span class="p">])</span>
<span class="c1"># Out: {</span>
<span class="c1">#   'micro': {'f': 0.57, 'p': 0.5, 'r': 0.67, 'tp': 2, 'support': 3, 'positives': 4, 'ap': 0.17},</span>
<span class="c1">#   'neg': {'f': 0.67, 'p': 0.5, 'r': 1, 'tp': 1, 'support': 1, 'positives': 2, 'ap': 0.0},</span>
<span class="c1">#   'carrier': {'f': 0.5, 'p': 0.5, 'r': 0.5, 'tp': 1, 'support': 2, 'positives': 2, 'ap': 0.25},</span>
<span class="c1"># }</span>
</code></pre></div> <h3 id="edsnlp.train.SpanAttributeMetric--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>span_getter</code></td> <td class="doc-param-details"> <p>The span getter to extract spans from each <code>Doc</code>.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-internal" href="../utils/span_getters/#edsnlp.utils.span_getters.SpanGetterArg" title="SpanGetterArg (edsnlp.utils.span_getters.SpanGetterArg)">SpanGetterArg</a></code> </span> </p> </td> </tr> <tr> <td><code>attributes</code></td> <td class="doc-param-details"> <p>Map each attribute name to <code>True</code> (evaluate on all spans) or a sequence of labels restricting which spans to test.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="Mapping">Mapping</span>[<span title="str">str</span>, <span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="Sequence">Sequence</span>[<span title="str">str</span>]]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>default_values</code></td> <td class="doc-param-details"> <p>Attribute values to omit from microaverage counts (e.g., common negative or default labels).</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>{}</code> </span> </p> </td> </tr> <tr> <td><code>include_falsy</code></td> <td class="doc-param-details"> <p>If <code>False</code>, ignore falsy values (e.g., <code>False</code>, <code>None</code>, <code>''</code>) in predictions or gold when computing metrics; if <code>True</code>, count them.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr> <td><code>micro_key</code></td> <td class="doc-param-details"> <p>Key under which to store the microaveraged results across all attributes.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="str">str</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'micro'</code> </span> </p> </td> </tr> <tr> <td><code>filter_expr</code></td> <td class="doc-param-details"> <p>A Python expression (using <code>doc</code>) to filter which examples are scored.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>A dictionary mapping each attribute name (and the <code>micro_key</code>) to its metrics:</p> <ul> <li> <p><code>label</code> or micro_key :</p> <ul> <li><code>p</code> : precision</li> <li><code>r</code> : recall</li> <li><code>f</code> : F1 score</li> <li><code>tp</code> : true positive count</li> <li><code>support</code> : number of gold instances</li> <li><code>positives</code> : number of predicted instances</li> <li><code>ap</code> : <a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision">average precision</a></li> </ul> </li> </ul> </div> </td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="edsnlp.train.SpanAttributeMetric.__call__"> <code class="highlight language-python"><span class="fm">__call__</span></code> </h3> <div class="doc doc-contents"> <p>Compute the span attribute metrics for the given examples.</p> <h4 id="edsnlp.train.SpanAttributeMetric.__call__--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>examples</code></td> <td class="doc-param-details"> <p>The examples to score, either a tuple of (golds, preds) or a list of spacy.training.Example objects</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.metrics.Examples">Examples</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>()</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>The scores for the attributes</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.BatchSizeArg"> <code>BatchSizeArg</code> </h2> <div class="doc doc-contents"> <p class="doc doc-class-bases"> Bases: <code><span title="edsnlp.utils.typing.Validated">Validated</span></code></p> <p>Batch size argument validator / caster for confit/pydantic</p> <h3 id="edsnlp.train.BatchSizeArg--examples">Examples</h3> <div class="no-check highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fn</span><span class="p">(</span><span class="n">batch_size</span><span class="p">:</span> <span class="n">BatchSizeArg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">batch_size</span>


<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="s2">"10 samples"</span><span class="p">))</span>
<span class="c1"># Out: (10, "samples")</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="s2">"10 words"</span><span class="p">))</span>
<span class="c1"># Out: (10, "words")</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># Out: (10, "samples")</span>
</code></pre></div> <div class="doc doc-children"> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent"> <code class="highlight language-python"><span class="n">TorchComponent</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L169" target="_blank">[source]</a></h2> <div class="doc doc-contents"> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" href="../pipes/base/#edsnlp.pipes.base.BaseComponent" title="BaseComponent (edsnlp.pipes.base.BaseComponent)">BaseComponent</a></code>, <code><span title="torch.nn.Module">Module</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="edsnlp.core.torch_component.BatchOutput">BatchOutput</span>, <span title="edsnlp.core.torch_component.BatchInput">BatchInput</span>]</code></p> <p>A TorchComponent is a Component that can be trained and inherits <code>torch.nn.Module</code>. You can use it either as a torch module inside a more complex neural network, or as a standalone component in a <a class="autorefs autorefs-internal" href="../../../concepts/pipeline/#edsnlp.core.pipeline.Pipeline">Pipeline</a>.</p> <p>In addition to the methods of a torch module, a TorchComponent adds a few methods to handle preprocessing and collating features, as well as caching intermediate results for components that share a common subcomponent.</p> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.post_init"> <code class="highlight language-python"><span class="n">post_init</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L223" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>This method completes the attributes of the component, by looking at some documents. It is especially useful to build vocabularies or detect the labels of a classification task.</p> <h4 id="edsnlp.train.TorchComponent.post_init--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>gold_data</code></td> <td class="doc-param-details"> <p>The documents to use for initialization.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>exclude</code></td> <td class="doc-param-details"> <p>The names of components to exclude from initialization. This argument will be gradually updated with the names of initialized components</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Set">Set</span>[<span title="str">str</span>]</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.preprocess"> <code class="highlight language-python"><span class="n">preprocess</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L246" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Preprocess the document to extract features that will be used by the neural network and its subcomponents on to perform its predictions.</p> <h4 id="edsnlp.train.TorchComponent.preprocess--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>doc</code></td> <td class="doc-param-details"> <p>Document to preprocess</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="spacy.tokens.Doc">Doc</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>Dictionary (optionally nested) containing the features extracted from the document.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.collate"> <code class="highlight language-python"><span class="n">collate</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L267" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Collate the batch of features into a single batch of tensors that can be used by the forward method of the component.</p> <h4 id="edsnlp.train.TorchComponent.collate--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch</code></td> <td class="doc-param-details"> <p>Batch of features</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.torch_component.BatchInput">BatchInput</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>Dictionary (optionally nested) containing the collated tensors</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.batch_to_device"> <code class="highlight language-python"><span class="n">batch_to_device</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L287" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Move the batch of tensors to the specified device.</p> <h4 id="edsnlp.train.TorchComponent.batch_to_device--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch</code></td> <td class="doc-param-details"> <p>Batch of tensors</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.core.torch_component.BatchInput">BatchInput</span></code> </span> </p> </td> </tr> <tr> <td><code>device</code></td> <td class="doc-param-details"> <p>Device to move the tensors to</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="torch.device">device</span>]]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.torch_component.BatchInput">BatchInput</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.forward"> <code class="highlight language-python"><span class="n">forward</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L318" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Perform the forward pass of the neural network.</p> <h4 id="edsnlp.train.TorchComponent.forward--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch</code></td> <td class="doc-param-details"> <p>Batch of tensors (nested dictionary) computed by the collate method</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.core.torch_component.BatchInput">BatchInput</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="edsnlp.core.torch_component.BatchOutput">BatchOutput</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.compute_training_metrics"> <code class="highlight language-python"><span class="n">compute_training_metrics</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L333" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Compute post-gather metrics on the batch output. This is a no-op by default. This is useful to compute averages when doing multi-gpu training or mini-batch accumulation since full denominators are not known during the forward pass.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.module_forward"> <code class="highlight language-python"><span class="n">module_forward</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L346" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>This is a wrapper around <code>torch.nn.Module.__call__</code> to avoid conflict with the components <code>__call__</code> method.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.prepare_batch"> <code class="highlight language-python"><span class="n">prepare_batch</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L353" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Convenience method to preprocess a batch of documents and collate them Features corresponding to the same path are grouped together in a list, under the same key.</p> <h4 id="edsnlp.train.TorchComponent.prepare_batch--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>docs</code></td> <td class="doc-param-details"> <p>Batch of documents</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Sequence">Sequence</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>supervision</code></td> <td class="doc-param-details"> <p>Whether to extract supervision features or not</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr> <td><code>device</code></td> <td class="doc-param-details"> <p>Device to move the tensors to</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="torch.device">device</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Sequence">Sequence</span>[<span title="typing.Any">Any</span>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.batch_process"> <code class="highlight language-python"><span class="n">batch_process</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L386" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Process a batch of documents using the neural network. This differs from the <code>pipe</code> method in that it does not return an iterator, but executes the component on the whole batch at once.</p> <h4 id="edsnlp.train.TorchComponent.batch_process--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>docs</code></td> <td class="doc-param-details"> <p>Batch of documents</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Sequence">Sequence</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Sequence">Sequence</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>Batch of updated documents</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.postprocess"> <code class="highlight language-python"><span class="n">postprocess</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L414" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Update the documents with the predictions of the neural network. By default, this is a no-op.</p> <h4 id="edsnlp.train.TorchComponent.postprocess--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>docs</code></td> <td class="doc-param-details"> <p>List of documents to update</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Sequence">Sequence</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>results</code></td> <td class="doc-param-details"> <p>Batch of predictions, as returned by the forward method</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="edsnlp.core.torch_component.BatchOutput">BatchOutput</span></code> </span> </p> </td> </tr> <tr> <td><code>inputs</code></td> <td class="doc-param-details"> <p>List of preprocessed features, as returned by the preprocess method</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Sequence">Sequence</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.preprocess_supervised"> <code class="highlight language-python"><span class="n">preprocess_supervised</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L437" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Preprocess the document to extract features that will be used by the neural network to perform its training. By default, this returns the same features as the <code>preprocess</code> method.</p> <h4 id="edsnlp.train.TorchComponent.preprocess_supervised--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>doc</code></td> <td class="doc-param-details"> <p>Document to preprocess</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="spacy.tokens.Doc">Doc</span></code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>Dictionary (optionally nested) containing the features extracted from the document.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading sourced-heading" id="edsnlp.train.TorchComponent.pipe"> <code class="highlight language-python"><span class="n">pipe</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/core/torch_component.py#L456" target="_blank">[source]</a></h3> <div class="doc doc-contents"> <p>Applies the component on a collection of documents. It is recommended to use the <a class="autorefs autorefs-internal" href="../core/pipeline/#edsnlp.core.pipeline.Pipeline.pipe" title="pipe"><code>Pipeline.pipe</code></a> method instead of this one to apply a pipeline on a collection of documents, to benefit from the caching of intermediate results.</p> <h4 id="edsnlp.train.TorchComponent.pipe--parameters">Parameters</h4> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>docs</code></td> <td class="doc-param-details"> <p>Input docs</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Doc">Doc</span>]</code> </span> </p> </td> </tr> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>Batch size to use when making batched to be process at once</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>1</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.LinearSchedule"> <code class="highlight language-python"><span class="n">LinearSchedule</span></code> </h2> <div class="doc doc-contents"> <p class="doc doc-class-bases"> Bases: <code><span title="edsnlp.training.optimizer.Schedule">Schedule</span></code></p> <p>Linear schedule for a parameter group. The schedule will linearly increase the value from <code>start_value</code> to <code>max_value</code> in the first <code>warmup_rate</code> of the <code>total_steps</code> and then linearly decrease it to <code>end_value</code>.</p> <h3 id="edsnlp.train.LinearSchedule--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>total_steps</code></td> <td class="doc-param-details"> <p>The total number of steps, usually used to calculate ratios.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>max_value</code></td> <td class="doc-param-details"> <p>The maximum value to reach.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>start_value</code></td> <td class="doc-param-details"> <p>The initial value.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="float">float</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>0.0</code> </span> </p> </td> </tr> <tr> <td><code>path</code></td> <td class="doc-param-details"> <p>The path to the attribute to set.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="int">int</span>, <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="int">int</span>]]]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>warmup_rate</code></td> <td class="doc-param-details"> <p>The rate of the warmup.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="float">float</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>0.0</code> </span> </p> </td> </tr> <tr> <td><code>end_value</code></td> <td class="doc-param-details"> <p>The final value to reach after the decay phase. Defaults to 0.0.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="float">float</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>0.0</code> </span> </p> </td> </tr> </tbody> </table> <div class="doc doc-children"> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.ScheduledOptimizer"> <code class="highlight language-python"><span class="n">ScheduledOptimizer</span></code> </h2> <div class="doc doc-contents"> <p class="doc doc-class-bases"> Bases: <code><span title="torch.optim.Optimizer">Optimizer</span></code></p> <p>Wrapper optimizer that supports schedules for the parameters and easy parameter selection using the key of the <code>groups</code> dictionary as regex patterns to match the parameter names.</p> <p>Schedules are defined directly in the groups, in place of the scheduled value.</p> <h3 id="edsnlp.train.ScheduledOptimizer--examples">Examples</h3> <div class="no-check highlight"><pre><span></span><code><span class="n">optim</span> <span class="o">=</span> <span class="n">ScheduledOptimizer</span><span class="p">(</span>
    <span class="bp">cls</span><span class="o">=</span><span class="s2">"adamw"</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">groups</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># Exclude all parameters matching 'bias' from optimization.</span>
        <span class="p">{</span>
            <span class="s2">"selector"</span><span class="p">:</span> <span class="s2">"bias"</span><span class="p">,</span>
            <span class="s2">"exclude"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="c1"># Parameters of the NER module's embedding receive this learning rate</span>
        <span class="c1"># schedule. If a parameter matches both 'transformer' and 'ner',</span>
        <span class="c1"># the first group settings take precedence due to the order.</span>
        <span class="p">{</span>
            <span class="s2">"selector"</span><span class="p">:</span> <span class="s2">"^ner[.]embedding"</span>
            <span class="s2">"lr"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"@schedules"</span><span class="p">:</span> <span class="s2">"linear"</span><span class="p">,</span>
                <span class="s2">"start_value"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">"max_value"</span><span class="p">:</span> <span class="mf">5e-4</span><span class="p">,</span>
                <span class="s2">"warmup_rate"</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="c1"># Parameters starting with 'ner' receive this learning rate schedule,</span>
        <span class="c1"># unless a 'lr' value has already been set by an earlier selector.</span>
        <span class="p">{</span>
            <span class="s2">"selector"</span><span class="p">:</span> <span class="s2">"^ner"</span>
            <span class="s2">"lr"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"@schedules"</span><span class="p">:</span> <span class="s2">"linear"</span><span class="p">,</span>
                <span class="s2">"start_value"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">"max_value"</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span>
                <span class="s2">"warmup_rate"</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="c1"># Apply a weight_decay of 0.01 to all parameters not excluded.</span>
        <span class="c1"># This setting doesn't conflict with others and applies to all.</span>
        <span class="p">{</span>
            <span class="s2">"selector"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
            <span class="s2">"weight_decay"</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="n">total_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <h3 id="edsnlp.train.ScheduledOptimizer--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>optim</code></td> <td class="doc-param-details"> <p>The optimizer to use. If a string (like "adamw") or a type to instantiate, the <code>module</code> and <code>groups</code> must be provided.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Type">Type</span>[<span title="torch.optim.Optimizer">Optimizer</span>], <span title="torch.optim.Optimizer">Optimizer</span>]</code> </span> </p> </td> </tr> <tr> <td><code>module</code></td> <td class="doc-param-details"> <p>The module to optimize. Usually the <code>nlp</code> pipeline object.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="edsnlp.core.PipelineProtocol">PipelineProtocol</span>, <span title="torch.nn.Module">Module</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>total_steps</code></td> <td class="doc-param-details"> <p>The total number of steps, used for schedules.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>groups</code></td> <td class="doc-param-details"> <p>The groups to optimize. Each group is a dictionary containing:</p> <ul> <li>a regex <code>selector</code> key to match the parameter of that group by their names (as listed by <code>nlp.named_parameters()</code>)</li> <li>and several other keys that define the optimizer parameters for that group, such as <code>lr</code>, <code>weight_decay</code> etc. The value for these keys can be a <code>Schedule</code> instance or a simple value</li> <li>an <code>exclude</code> key that can be set to True to exclude parameters</li> </ul> <p>The matching is performed by running <code>regex.search(selector, name)</code> so you do not have to match the full name. Note that the order of the groups matters. If a parameter name matches multiple selectors, the configurations of these selectors are combined in reverse order (from the last matched selector to the first), allowing later selectors to complete options from earlier ones. If a selector contains <code>exclude=True</code>, any parameter matching it is excluded from optimization.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="Group">Group</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <div class="doc doc-children"> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.GenericScorer"> <code class="highlight language-python"><span class="n">GenericScorer</span></code> </h2> <div class="doc doc-contents"> <p>A scorer to evaluate the model performance on various tasks.</p> <h3 id="edsnlp.train.GenericScorer--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size to use for scoring. Can be an int (number of documents) or a string (batching expression like "2000 words").</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>1</code> </span> </p> </td> </tr> <tr> <td><code>speed</code></td> <td class="doc-param-details"> <p>Whether to compute the model speed (words/documents per second)</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr> <td><code>autocast</code></td> <td class="doc-param-details"> <p>Whether to use autocasting for mixed precision during the evaluation, defaults to True.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="bool">bool</span>, <span title="typing.Any">Any</span>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>metrics</code></td> <td class="doc-param-details"> <p>A keyword arguments mapping of metric names to metrics objects. See the <a href="../../../metrics">metrics</a> documentation for more info.</p> <p> <span class="doc-param-default"> <b>DEFAULT:</b> <code>{}</code> </span> </p> </td> </tr> </tbody> </table> <div class="doc doc-children"> </div> </div> </div><div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="edsnlp.train.TrainingData"> <code class="highlight language-python"><span class="n">TrainingData</span></code> </h2> <div class="doc doc-contents"> <p>A training data object.</p> <h3 id="edsnlp.train.TrainingData--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>data</code></td> <td class="doc-param-details"> <p>The stream of documents to train on. The documents will be preprocessed and collated according to the pipeline's components.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-internal" href="../../../concepts/inference/#edsnlp.core.stream.Stream" title="Streams (edsnlp.core.stream.Stream)">Stream</a></code> </span> </p> </td> </tr> <tr> <td><code>batch_size</code></td> <td class="doc-param-details"> <p>The batch size. Can be a batching expression like "2000 words", an int (number of documents), or a tuple (batch_size, batch_by). The batch_by argument should be a statistic produced by the pipes that will be trained. For instance, the <code><a href="../../../pipes/trainable/embeddings/span_pooler/#edsnlp.pipes.trainable.embeddings.span_pooler.factory.create_component">eds.span_pooler</a></code> component produces a "spans" statistic, that can be used to produce batches of no more than 16 spans by setting batch_size to "16 spans".</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-internal" href="../utils/batching/#edsnlp.utils.batching.BatchSizeArg" title="BatchSizeArg (edsnlp.utils.batching.BatchSizeArg)">BatchSizeArg</a></code> </span> </p> </td> </tr> <tr> <td><code>shuffle</code></td> <td class="doc-param-details"> <p>The shuffle strategy. Can be "dataset" to shuffle the entire dataset (this can be memory-intensive for large file based datasets), "fragment" to shuffle the fragment-based datasets like parquet files, or a batching expression like "2000 words" to shuffle the dataset in chunks of 2000 words.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing_extensions.Literal">Literal</span>[False]]</code> </span> </p> </td> </tr> <tr> <td><code>sub_batch_size</code></td> <td class="doc-param-details"> <p>How to split each batch into sub-batches that will be fed to the model independently to accumulate gradients over. To split a batch of 8000 tokens into smaller batches of 1000 tokens each, just set this to "1000 tokens".</p> <p>You can also request a number of splits, like "4 splits", to split the batch into N parts each close to (but less than) batch_size / N.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" href="../utils/batching/#edsnlp.utils.batching.BatchSizeArg" title="BatchSizeArg (edsnlp.utils.batching.BatchSizeArg)">BatchSizeArg</a>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>pipe_names</code></td> <td class="doc-param-details"> <p>The names of the pipes that should be trained on this data. If None, defaults to all trainable pipes.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Optional">Optional</span>[<span title="edsnlp.utils.typing.AsList">AsList</span>[<span title="str">str</span>]]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr> <td><code>post_init</code></td> <td class="doc-param-details"> <p>Whether to call the pipeline's post_init method with the data before training.</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="bool">bool</span></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading sourced-heading" id="edsnlp.train.stat_batchify"> <code class="highlight language-python"><span class="n">stat_batchify</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/utils/batching.py#L373" target="_blank">[source]</a></h2> <div class="doc doc-contents"> <p>Create a batching function that uses the value of a specific key in the items to determine the batch size. This function is primarily meant to be used on the flattened outputs of the <code>preprocess</code> method of a <a class="autorefs autorefs-internal" href="../../../concepts/pipeline/#edsnlp.core.pipeline.Pipeline">Pipeline</a> object.</p> <p>It expects the items to be a dictionary in which some keys contain the string "/stats/" and the <code>key</code> pattern. For instance:</p> <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">edsnlp.utils.batching</span><span class="w"> </span><span class="kn">import</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../utils/batching/#edsnlp.utils.batching.stat_batchify">stat_batchify</a></body></html></span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"first sample"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"dos"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"third one !"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">11</span><span class="p">},</span>
<span class="p">]</span>
<span class="n">batcher</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../utils/batching/#edsnlp.utils.batching.stat_batchify">stat_batchify</a></body></html></span><span class="p">(</span><span class="s2">"words"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">batcher</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"first sample"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"dos"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"third one !"</span><span class="p">,</span> <span class="s2">"obj/stats/words"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"obj/stats/chars"</span><span class="p">:</span> <span class="mi">11</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">]</span>
</code></pre></div> <h3 id="edsnlp.train.stat_batchify--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>key</code></td> <td class="doc-param-details"> <p>The key pattern to use to determine the actual key to look up in the items.</p> <p> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code>Callable[[Iterable, int, bool, Literal["drop", "split"]], Iterable</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading sourced-heading" id="edsnlp.train.decompress_dict"> <code class="highlight language-python"><span class="n">decompress_dict</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/utils/collections.py#L134" target="_blank">[source]</a></h2> <div class="doc doc-contents"> <p>Decompress a dictionary of lists into a sequence of dictionaries. This function assumes that the dictionary structure was obtained using the <code>batch_compress_dict</code> class. Keys that were merged into a single string using the "|" character as a separator will be split into a nested dictionary structure.</p> <h3 id="edsnlp.train.decompress_dict--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>seq</code></td> <td class="doc-param-details"> <p>The dictionary to decompress or a sequence of dictionaries to decompress</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Union">Union</span>[<span title="typing.Iterable">Iterable</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code> </span> </p> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading sourced-heading" id="edsnlp.train.ld_to_dl"> <code class="highlight language-python"><span class="n">ld_to_dl</span></code> <span class="sourced-heading-spacer"></span><a href="https://github.com/aphp/edsnlp/blob/dd51fcc9c/edsnlp/utils/collections.py#L24" target="_blank">[source]</a></h2> <div class="doc doc-contents"> <p>Convert a list of dictionaries to a dictionary of lists</p> <h3 id="edsnlp.train.ld_to_dl--parameters">Parameters</h3> <table> <thead> <tr> <th><b>PARAMETER</b></th> <th><b>DESCRIPTION</b></th> </tr> </thead> <tbody> <tr> <td><code>ld</code></td> <td class="doc-param-details"> <p>The list of dictionaries</p> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><span title="typing.Iterable">Iterable</span>[<span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="edsnlp.utils.collections.T">T</span>]]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="edsnlp.utils.collections.T">T</span>]]</code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>The dictionary of lists</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> <div class="footnote"><hr/><ol></ol></div> </article> </div> </div> <button class="md-top md-icon" data-md-component="top" hidden="" type="button"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: reducers" class="md-footer__link md-footer__link--prev" href="../reducers/" rel="prev"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> reducers </div> </div> </a> <a aria-label="Next: Overview" class="md-footer__link md-footer__link--next" href="../training/" rel="next"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> Overview </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Copyright  2025  Assistance Publique - Hpitaux de Paris </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.prune", "navigation.top", "navigation.footer", "content.code.annotate", "content.code.copy", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src="../../../assets/javascripts/bundle.dff1b7c8.min.js"></script> <script pret-head-scripts=""></script> </body> </html>